<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#020204">
    <title>HoloWorld | Xavier OS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="admin-fix.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; touch-action: none; }
        body { 
            background: #020204; 
            color: #e0e0e0; 
            font-family: 'Rajdhani', sans-serif;
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }
        #canvas-container { 
            position: fixed; 
            inset: 0; 
            z-index: 1;
        }
        .ui-layer { 
            position: fixed; 
            inset: 0; 
            z-index: 10; 
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 1rem;
        }
        .pointer-events-auto { pointer-events: auto; }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        
        .holo-panel {
            background: rgba(10, 14, 39, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 240, 255, 0.2);
            border-radius: 16px;
        }
        
        .quantum-btn {
            background: rgba(0,240,255,0.1);
            border: 1px solid rgba(0,240,255,0.3);
            color: #00f0ff;
            min-height: 44px;
            min-width: 44px;
            transition: all 0.2s;
        }
        .quantum-btn:active { transform: scale(0.95); background: rgba(0,240,255,0.3); }
        
        #loader {
            position: fixed; inset: 0; background: #020204; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.5s;
        }
        .loader-ring {
            width: 80px; height: 80px;
            border: 3px solid transparent;
            border-top: 3px solid #00f0ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .quality-badge {
            position: absolute;
            top: 20px; right: 20px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            z-index: 20;
        }
        .q-high { background: rgba(0,255,136,0.2); border: 1px solid #00ff88; color: #00ff88; }
        .q-med { background: rgba(255,193,7,0.2); border: 1px solid #ffc107; color: #ffc107; }
        .q-low { background: rgba(255,68,68,0.2); border: 1px solid #ff4444; color: #ff4444; }
        
        .gesture-hint {
            position: absolute;
            bottom: 200px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 12px;
            color: #888;
            pointer-events: none;
            animation: fadeOut 3s forwards 2s;
        }
        @keyframes fadeOut { to { opacity: 0; } }
    </style>
</head>
<body>
    <div id="loader">
        <div class="loader-ring mb-4"></div>
        <h1 class="font-orbitron text-xl text-cyan-400">HOLOVERSE</h1>
        <p class="text-gray-500 text-sm mt-2" id="loading-text">Initializing...</p>
    </div>

    <div id="quality-badge" class="quality-badge q-high">Ultra</div>

    <div id="canvas-container"></div>
    <div class="gesture-hint">üëÜ Drag to rotate ‚Ä¢ Pinch to zoom</div>

    <div class="ui-layer">
        <header class="flex justify-between items-start">
            <div class="holo-panel p-3 flex items-center gap-3 pointer-events-auto">
                <button onclick="window.location.href='index.html'" class="text-gray-400 hover:text-cyan-400 text-xl">‚Üê</button>
                <div>
                    <h1 class="font-orbitron text-lg font-bold text-cyan-400">HOLOVERSE</h1>
                    <p class="text-[10px] text-gray-400 font-mono" id="fps">60 FPS</p>
                </div>
            </div>
            <button onclick="toggleAutoRotate()" id="rotate-btn" class="holo-panel p-3 text-cyan-400 pointer-events-auto">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M23 4v6h-6M1 20v-6h6M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                </svg>
            </button>
        </header>

        <div class="flex flex-col gap-3 items-end mb-4">
            <div class="holo-panel p-3 w-full max-w-xs pointer-events-auto">
                <h3 class="font-orbitron text-xs text-purple-400 mb-2 uppercase">Quality</h3>
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="setQuality('high')" class="quantum-btn rounded py-2 text-xs">Ultra</button>
                    <button onclick="setQuality('medium')" class="quantum-btn rounded py-2 text-xs" style="border-color:#b026ff;color:#b026ff">Balanced</button>
                    <button onclick="setQuality('low')" class="quantum-btn rounded py-2 text-xs" style="border-color:#ff4444;color:#ff4444">Perf</button>
                </div>
                <button onclick="resetCamera()" class="quantum-btn rounded py-2 text-xs w-full mt-2" style="border-color:#ffc107;color:#ffc107">Reset View</button>
            </div>
        </div>
    </div>

    <script>
        if (!XavierUnlock.hasAccess('holoworld')) {
            alert('üîí HOLOVERSE requires Pro tier');
            window.location.href = 'pricing.html';
        }

        let scene, camera, renderer, controls, mainObject, particles;
        let autoRotate = true, quality = 'high', isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
        let frameCount = 0, lastTime = performance.now(), fps = 60;

        function init() {
            const container = document.getElementById('canvas-container');
            
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
            const gpu = debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : 'unknown';
            
            if (gpu.includes('Mali') || gpu.includes('Adreno 5') || isMobile) {
                quality = 'medium';
                document.getElementById('quality-badge').className = 'quality-badge q-med';
                document.getElementById('quality-badge').textContent = 'Balanced';
            }
            
            document.getElementById('loading-text').textContent = 'Loading 3D Engine...';
            
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x020204, isMobile ? 0.03 : 0.02);
            
            camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.set(5, 3, 5);
            
            renderer = new THREE.WebGLRenderer({ 
                antialias: !isMobile, 
                powerPreference: "high-performance",
                stencil: false 
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, isMobile ? 1.5 : 2));
            renderer.shadowMap.enabled = !isMobile;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            container.appendChild(renderer.domElement);
            
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.1;
            controls.enablePan = false;
            controls.maxPolarAngle = Math.PI/2;
            controls.minDistance = 2;
            controls.maxDistance = 15;
            
            const ambient = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambient);
            
            const mainLight = new THREE.DirectionalLight(0x00f0ff, isMobile ? 0.8 : 1.2);
            mainLight.position.set(5, 10, 5);
            if (!isMobile) mainLight.castShadow = true;
            scene.add(mainLight);
            
            const rimLight = new THREE.DirectionalLight(0xb026ff, 0.6);
            rimLight.position.set(-5, 5, -5);
            scene.add(rimLight);
            
            createScene();
            
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth/window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }, {passive:true});
            
            setTimeout(() => {
                document.getElementById('loader').style.opacity = '0';
                setTimeout(() => document.getElementById('loader').remove(), 500);
            }, 1000);
            
            animate();
        }

        function createScene() {
            if (mainObject) scene.remove(mainObject);
            
            let geo, mat;
            if (quality === 'high') {
                geo = new THREE.TorusKnotGeometry(1.5, 0.4, 128, 16, 2, 3);
                mat = new THREE.MeshPhysicalMaterial({
                    color: 0x222222, metalness: 1, roughness: 0.15,
                    clearcoat: 1, emissive: 0x00f0ff, emissiveIntensity: 0.1
                });
            } else if (quality === 'medium') {
                geo = new THREE.TorusKnotGeometry(1.5, 0.4, 64, 12, 2, 3);
                mat = new THREE.MeshStandardMaterial({ color: 0x333333, metalness: 0.9, roughness: 0.2 });
            } else {
                geo = new THREE.IcosahedronGeometry(1.8, 2);
                mat = new THREE.MeshStandardMaterial({ color: 0x00f0ff, metalness: 0.8, roughness: 0.3, wireframe: true });
            }
            
            mainObject = new THREE.Mesh(geo, mat);
            mainObject.position.y = 1.5;
            scene.add(mainObject);
            
            const coreGeo = new THREE.IcosahedronGeometry(0.8, 0);
            const coreMat = new THREE.MeshBasicMaterial({ color: 0x00f0ff, wireframe: true, transparent: true, opacity: 0.8 });
            const core = new THREE.Mesh(coreGeo, coreMat);
            core.position.y = 1.5;
            mainObject.add(core);
            mainObject.userData.core = core;
            
            if (quality !== 'low') {
                const ringGeo = new THREE.TorusGeometry(2.5, 0.03, 8, 64);
                const ringMat = new THREE.MeshBasicMaterial({ color: 0xb026ff, transparent: true, opacity: 0.6 });
                const ring = new THREE.Mesh(ringGeo, ringMat);
                ring.position.y = 1.5;
                ring.rotation.x = Math.PI/2;
                scene.add(ring);
                mainObject.userData.ring = ring;
            }
            
            const count = quality === 'high' ? 1000 : (quality === 'medium' ? 500 : 200);
            const pgeo = new THREE.BufferGeometry();
            const pos = new Float32Array(count * 3);
            for (let i = 0; i < count; i++) {
                pos[i*3] = (Math.random()-0.5)*30;
                pos[i*3+1] = Math.random()*15;
                pos[i*3+2] = (Math.random()-0.5)*30;
            }
            pgeo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
            const pmat = new THREE.PointsMaterial({ color: quality==='low'?0x00f0ff:0xffffff, size: 0.05, transparent: true, opacity: 0.6 });
            particles = new THREE.Points(pgeo, pmat);
            scene.add(particles);
            
            const grid = new THREE.GridHelper(20, 20, 0x00f0ff, 0x222222);
            grid.position.y = 0;
            grid.material.transparent = true;
            grid.material.opacity = 0.2;
            scene.add(grid);
        }

        function animate() {
            requestAnimationFrame(animate);
            const time = Date.now() * 0.001;
            
            frameCount++;
            const now = performance.now();
            if (now - lastTime >= 1000) {
                fps = Math.round((frameCount*1000)/(now-lastTime));
                document.getElementById('fps').textContent = fps + ' FPS';
                frameCount = 0;
                lastTime = now;
                if (fps < 30 && quality === 'high' && isMobile) setQuality('medium');
            }
            
            if (autoRotate && mainObject) {
                mainObject.rotation.x = time * 0.15;
                mainObject.rotation.y = time * 0.25;
                if (mainObject.userData.core) mainObject.userData.core.rotation.y = -time * 0.5;
                if (mainObject.userData.ring) mainObject.userData.ring.rotation.z = time * 0.2;
            }
            
            if (particles) particles.rotation.y = time * 0.02;
            
            controls.update();
            renderer.render(scene, camera);
        }

        function toggleAutoRotate() {
            autoRotate = !autoRotate;
            document.getElementById('rotate-btn').style.opacity = autoRotate ? '1' : '0.5';
        }

        function resetCamera() {
            camera.position.set(5, 3, 5);
            controls.target.set(0, 0, 0);
            controls.update();
        }

        function setQuality(q) {
            quality = q;
            const badge = document.getElementById('quality-badge');
            if (q === 'high') { badge.className = 'quality-badge q-high'; badge.textContent = 'Ultra'; }
            else if (q === 'medium') { badge.className = 'quality-badge q-med'; badge.textContent = 'Balanced'; }
            else { badge.className = 'quality-badge q-low'; badge.textContent = 'Perf'; }
            createScene();
        }

        let lastTouch = 0;
        document.addEventListener('touchend', (e) => {
            const now = Date.now();
            if (now - lastTouch <= 300) e.preventDefault();
            lastTouch = now;
        }, false);

        init();
    </script>
</body>
</html>
